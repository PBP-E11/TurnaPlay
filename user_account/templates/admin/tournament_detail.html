{% extends 'minimal.html' %}
{% load static %}
{% block meta %}
<title>Tournament Detail - TurnaPlay Admin</title>
{% endblock %}

{% block content %}
<div class="flex min-h-screen grid grid-flow-row bg-gray-50">
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        {% include 'admin/_sidebar.html' %}

        <!-- Main Content -->
        <div class="flex-1 overflow-y-auto">
            <div class="max-w-7xl mx-auto p-6">
                <!-- Breadcrumb -->
                <div class="flex items-center gap-2 text-sm text-gray-600 mb-6">
                    <a href="{% url 'user_account:admin_manage_tournaments' %}" class="text-[#494598] hover:underline">Manage Tournaments</a>
                    <span>›</span>
                    <span>Tournament Detail</span>
                </div>

                <h1 class="text-2xl font-bold text-gray-900 mb-6">Tournament Detail</h1>

                <!-- Tournament Header Card -->
                <div class="bg-gradient-to-r from-[#494598] to-[#5d59a6] text-white p-8 rounded-xl mb-6 shadow-lg relative overflow-hidden">
                    <!-- Background Pattern -->
                    <div class="absolute inset-0 opacity-10">
                        <div class="absolute top-0 right-0 w-64 h-64 bg-white rounded-full -translate-y-1/2 translate-x-1/2"></div>
                        <div class="absolute bottom-0 left-0 w-48 h-48 bg-white rounded-full translate-y-1/2 -translate-x-1/2"></div>
                    </div>
                    
                    <div class="relative z-10">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <h2 class="text-3xl font-bold">{{ tournament.tournament_name }}</h2>
                                </div>
                                <p class="text-white/80 text-sm mb-4">{{ tournament.description }}</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-4 gap-4 mt-6">
                            <div class="bg-white/10 backdrop-blur rounded-lg p-4">
                                <div class="text-white/70 text-xs mb-1">Organizer</div>
                                <div class="font-semibold text-base">@{{ tournament.organizer.username }}</div>
                            </div>
                            <div class="bg-white/10 backdrop-blur rounded-lg p-4">
                                <div class="text-white/70 text-xs mb-1">Game</div>
                                <div class="font-semibold text-base">{{ tournament.tournament_format.game.name }}</div>
                            </div>
                            <div class="bg-white/10 backdrop-blur rounded-lg p-4">
                                <div class="text-white/70 text-xs mb-1">Teams</div>
                                <div class="font-semibold text-base">{{ registrations.count }}/{{ tournament.team_maximum_count }}</div>
                            </div>
                            <div class="bg-white/10 backdrop-blur rounded-lg p-4">
                                <div class="text-white/70 text-xs mb-1">Prize Pool</div>
                                <div class="font-semibold text-base">Rp {{ tournament.prize_pool|floatformat:0 }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tournament Info Grid -->
                <div class="grid grid-cols-2 gap-5 mb-6">
                    <div class="bg-white border border-gray-200 p-5 rounded-xl">
                        <div class="text-gray-500 text-sm mb-2">Tournament Format</div>
                        <div class="text-gray-900 font-semibold">{{ tournament.tournament_format.name }}</div>
                    </div>
                    <div class="bg-white border border-gray-200 p-5 rounded-xl">
                        <div class="text-gray-500 text-sm mb-2">Team Size</div>
                        <div class="text-gray-900 font-semibold">{{ tournament.tournament_format.team_size }} Players per Team</div>
                    </div>
                    <div class="bg-white border border-gray-200 p-5 rounded-xl">
                        <div class="text-gray-500 text-sm mb-2">Tournament Date</div>
                        <div class="text-gray-900 font-semibold">
                            {% if tournament.tournament_date %}
                                {{ tournament.tournament_date|date:"d M Y" }}
                            {% else %}
                                TBA
                            {% endif %}
                        </div>
                    </div>
                    <div class="bg-white border border-gray-200 p-5 rounded-xl">
                        <div class="text-gray-500 text-sm mb-2">Created At</div>
                        <div class="text-gray-900 font-semibold">{{ tournament.created_at|date:"d M Y, H:i" }}</div>
                    </div>
                </div>

                <!-- Registered Teams Section -->
                <div class="bg-white border border-gray-200 rounded-xl p-6 mb-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-5">Registered Teams</h2>
                    
                    {% if registrations %}
                        <div class="space-y-3">
                            {% for registration in registrations %}
                            <div class="border border-gray-200 rounded-lg p-4 hover:border-[#494598] hover:shadow-sm transition">
                                <div class="flex items-start justify-between mb-3">
                                    <div>
                                        <div class="font-semibold text-gray-900 text-base flex items-center gap-2">
                                            {{ registration.team_name }}
                                            <span class="px-2 py-0.5 text-xs rounded-full font-medium
                                                {% if registration.status == 'registered' %}bg-blue-100 text-blue-700
                                                {% elif registration.status == 'valid' %}bg-green-100 text-green-700
                                                {% else %}bg-gray-100 text-gray-700{% endif %}">
                                                {{ registration.get_status_display }}
                                            </span>
                                        </div>
                                        <div class="text-xs text-gray-500 mt-1">
                                            {{ registration.members.count }} / {{ tournament.tournament_format.team_size }} members
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Team Members -->
                                <div class="mt-3 space-y-2">
                                    {% for member in registration.members.all %}
                                    <div class="flex items-center gap-2 text-sm bg-gray-50 rounded px-3 py-2">
                                        <img src="https://ui-avatars.com/api/?name={{ member.game_account.user.display_name }}&size=24&background=494598&color=fff" 
                                             class="w-6 h-6 rounded-full">
                                        <span class="text-gray-900">{{ member.game_account.user.display_name }}</span>
                                        <span class="text-gray-500">(@{{ member.game_account.user.username }})</span>
                                        {% if member.is_leader %}
                                        <span class="ml-auto px-2 py-0.5 bg-[#494598] text-white text-xs rounded-full">Leader</span>
                                        {% endif %}
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-12 text-gray-500">
                            <div class="text-5xl mb-3">👥</div>
                            <p class="text-sm">No teams registered yet</p>
                            <p class="text-xs mt-1">Teams will appear here once they register</p>
                        </div>
                    {% endif %}
                </div>

                <!-- Individual Participants Section -->
                <div class="bg-white border border-gray-200 rounded-xl p-6 mb-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-5">Individual Participants</h2>
                    
                    {% if participant_records %}
                        <div class="space-y-2.5">
                            {% for record in participant_records %}
                            <div class="border border-gray-200 rounded-lg p-4 hover:border-[#494598] hover:shadow-sm transition">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <img src="https://ui-avatars.com/api/?name={{ record.participant.display_name }}&size=40&background=494598&color=fff" 
                                             class="w-10 h-10 rounded-full">
                                        <div>
                                            <div class="font-semibold text-gray-900 text-sm">{{ record.participant.display_name }}</div>
                                            <div class="text-xs text-gray-500">@{{ record.participant.username }}</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xs text-gray-500">Registered</div>
                                        <div class="text-sm text-gray-900 font-medium">{{ record.registered_at|date:"d M Y" }}</div>
                                        <span class="inline-block mt-1 px-2 py-0.5 text-xs rounded-full font-medium
                                            {% if record.status == 'confirmed' %}bg-green-100 text-green-700
                                            {% elif record.status == 'registered' %}bg-blue-100 text-blue-700
                                            {% elif record.status == 'cancelled' %}bg-red-100 text-red-700
                                            {% else %}bg-gray-100 text-gray-700{% endif %}">
                                            {{ record.get_status_display }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-12 text-gray-500">
                            <div class="text-5xl mb-3">👥</div>
                            <p class="text-sm">No individual participants registered yet</p>
                        </div>
                    {% endif %}
                </div>

                <!-- Action Buttons -->
                <div class="flex gap-3">
                    <a href="{% url 'user_account:admin_manage_tournaments' %}" class="px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-semibold transition hover:bg-gray-200">
                        ← Back to Tournament List
                    </a>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer -->
    <div class="bg-[#302D74] h-[28px] flex justify-center items-center font-semibold text-xs text-white">
        © 2025 TurnaPlay - All rights reserved.
    </div>
</div>
{% endblock %}
